import authActionTypes from "./types";
import authService from "./service";

import { push } from "connected-react-router";

function login(username, password, prevLocation) {
    return dispatch => {
        dispatch({ type: authActionTypes.LOGIN_REQUEST, username })
        authService.login(username, password)
            .then(user => {
                dispatch({ type: authActionTypes.LOGIN_SUCCESS, user: user, prevLocation: null });
                dispatch(push(prevLocation || "/"));
            })
            .catch(error => {
                dispatch({ type: authActionTypes.LOGIN_FAILURE})
                dispatch(push({ pathname: "/login", state: {error} }))
            })
    }
}

function logout(state, prevLocation) {
    return dispatch => {
        authService.logout();
        if(prevLocation && prevLocation.pathname === "/login")
            prevLocation = null;
        dispatch({ type: authActionTypes.LOGOUT, prevLocation });
        dispatch(push({ pathname: "/login", state }))
    }
}

export default { login, logout };