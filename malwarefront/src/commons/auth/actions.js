import authActionTypes from "./types";
import authService from "./service";

import { push } from "connected-react-router";

function login(username, password, prevLocation) {
    return dispatch => {
        dispatch({ type: authActionTypes.LOGIN_REQUEST, username })
        authService.login(username, password)
            .then(user => {
                dispatch({ type: authActionTypes.LOGIN_SUCCESS, user: user, prevLocation: null });
                dispatch(push(prevLocation || "/"));
            })
            .catch(error => dispatch({ type: authActionTypes.LOGIN_FAILURE, error }))
    }
}

function logout(error, prevLocation) {
    return dispatch => {
        authService.logout();
        if(prevLocation && prevLocation.pathname === "/login")
            prevLocation = null;
        dispatch({ type: authActionTypes.LOGOUT, error, prevLocation });
        dispatch(push("/login"))
    }
}

export default { login, logout };