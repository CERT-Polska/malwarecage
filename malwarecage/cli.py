import click
from flask.cli import FlaskGroup

from malwarecage.core.config import app_config

MISSING_CONFIG_MESSAGE = """
Oops, required configuration is missing. Use 'malwarecage init' to configure your Malwarecage instance.
PostgreSQL and Redis connection strings will be required, so make sure you have installed these elements first.
"""


def create_app():
    from . import app
    return app.app


@click.group(cls=FlaskGroup, create_app=create_app)
@click.pass_context
def cli(ctx):
    """Malwarecage malware database"""
    try:
        app_config.read()
    except:
        click.echo(MISSING_CONFIG_MESSAGE, err=True)
        ctx.abort()


@cli.command()
def init():
    """
    Configure Malwarecage instance
    """
