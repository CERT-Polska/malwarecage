import React from 'react';
import {Link} from 'react-router-dom';

import { RecentView } from "./RecentView";
import {TagList} from './Tag';
import { Identicon, DateString } from "@malwarefront/ui";

function RecentFileRow(props) {
    const identicon = (
        <Identicon hash={props.md5} size="45" style={{
            float: "left",
            marginRight: "8pt"
        }}/>
    )
    const fileName = <div className="recent-field">{props.file_name}</div>
    const fileSize = <div className="recent-field">{props.file_size}</div>
    const fileType = <div className="recent-field">{props.file_type}</div>
    const sha256 = (
        <div className="recent-field">
            <Link to={`/sample/${props.sha256}`} className="monospace">
                <div className="middle-ellipsis">
                    <div className="start">
                        {props.sha256.slice(0, -12)}
                    </div>
                    <div className="end">
                        {props.sha256.slice(-12)}
                    </div>
                </div>
            </Link>
        </div>
    )
    const md5 = (
        <div className="recent-field">
            <Link to={`/sample/${props.md5}`} className="monospace">
                <div className="middle-ellipsis">
                    <div className="start">
                        {props.md5.slice(0, -12)}
                    </div>
                    <div className="end">
                        {props.md5.slice(-12)}
                    </div>
                </div>
            </Link>
        </div>
    )
    const uploadTime = <DateString date={props.upload_time}/>
    const tags = (
        <TagList tags={props.tags}
                            tagClick={(ev, tag) => { ev.preventDefault(); props.addToQuery("tag", tag) }}
                            tagRemove={(ev, tag) => props.addToQuery("NOT tag", tag)}
                            filterable/>
    )

    return (
        <tr className="d-flex">
            <td className="col-md-4 col-6">
                {/* Show Identicon only in wide mode */}
                <div className="d-none d-md-block">{identicon}</div>
                {/* Show always */}
                <div className="d-flex">
                    <b style={{minWidth: "4.5rem"}}>Name: </b>
                    {fileName}
                </div>
                <div className="d-flex">
                    <b style={{minWidth: "4.5rem"}}>SHA256: </b>
                    {sha256}
                </div>
                {/* Show MD5 only in wide mode */}
                <div className="d-none d-md-flex">
                    <b style={{minWidth: "4.5rem"}}>MD5: </b>
                    {md5}
                </div>
                {/* Show Date only in shrinked mode */}
                <div className="d-md-none d-flex">
                    <b style={{minWidth: "4.5rem"}}>Date: </b>
                    {uploadTime}
                </div>
            </td>
            <td className="col-md-3 col-6">
                {/* Wide mode */}
                <div className="d-flex">
                    <b style={{minWidth: "3rem"}}>Size: </b>
                    {fileSize}
                </div>
                <div className="d-flex">
                    <b style={{minWidth: "3rem"}}>Type: </b>
                    {fileType}
                </div>
                {/* All modes */}
                <div className="d-md-none">
                    {tags}
                </div>
            </td>
            <td className="col-md-3 d-none d-md-block">
                {/* Wide mode */}
                {tags}
            </td>
            <td className="col-md-2 d-none d-md-block">
                {/* Wide mode */}
                {uploadTime}
            </td>
        </tr>
    )
}

function RecentFileHeader() {
    return (
        <tr className="d-flex">
            {/* Shrinked mode */}
            <th className="col-6 d-md-none">Name/SHA256/First seen</th>
            <th className="col-6 d-md-none">Size/Type/Tags</th>
            {/* Wide mode */}
            <th className="col-4 d-none d-md-block">Name/Hash</th>
            <th className="col-3 d-none d-md-block">Size/Type</th>
            <th className="col-3 d-none d-md-block">Tags</th>
            <th className="col-2 d-none d-md-block">First seen</th>
        </tr>
    )
}

export default (props) => (
    <RecentView type="file" 
                rowComponent={RecentFileRow} 
                headerComponent={RecentFileHeader}
                {...props}/>
)
