import React from "react";
import {TagList} from '../Tag';

function getHighlightClass(upload_time) {
    let delta = new Date() - new Date(upload_time);
    if (delta < 24*60*60*1000)
        return "today";
    if (delta < 72*60*60*1000)
        return "recently";
    return "";
}

export function ObjectField(args) {
    const FieldItem = (props) => (
        <td style={args.style || {
            textOverflow: 'ellipsis',
            overflow: 'hidden',
            whiteSpace: 'nowrap',
            textAlign: 'left',
            wordBreak: 'break-all'
        }} className={args.className || ""}>
            {args.render(props)}
        </td>
    )
    FieldItem.label = args.label
    return FieldItem
}

export function TagField(args)
{   
    return ObjectField({
        ...args,
        render: (props) => (
            <TagList tags={props.tags}
                     tagClick={(ev, tag) => { ev.preventDefault(); props.addToQuery("tag", tag) }}
                     tagRemove={(ev, tag) => props.addToQuery("NOT tag", tag)}
                     filterable/>
        )
    })
}

export function QueryableField(args) {
    return ObjectField({
        ...args,
        render: (props) => (
            <a href="#query" onClick={(ev) => { 
                ev.preventDefault(); 
                props.addToQuery(args.queryKey, args.queryValue(props))
            }}>
                {args.queryValue(props)}
            </a>
        )
    })
}

export function ObjectRow(fields) {
    const RowItem = (props) => (
        <tr key={props.id} className={getHighlightClass(props.upload_time)}>
            {fields.map((Field, idx) => <Field key={idx} {...props}/>)}
        </tr>
    )
    RowItem.labels = fields.map(f => f.label)
    return RowItem
}
