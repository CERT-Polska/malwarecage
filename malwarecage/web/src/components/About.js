import React, {Component} from 'react';
import { connect } from 'react-redux';
import { View } from "@malwarefront/ui";

import logo from "../assets/logo.png";

const PluginItems = (props) => {
    const { name, info } = props;
    const { active, version, description } = info;

    return(
        <tr>
            <td>{name}{" "}
                {active
                ? <span className="badge badge-success">Active</span>
                : <span className="badge badge-danger">Inactive</span>}
            </td>
            <td>{description}</td>
            <td>{version}</td>
        </tr>
    )
}

const PluginsTable = (props) => {
    if (props.plugins.length) {
        return (
            <div className="container">
                <table className="table table-striped table-bordered wrap-table" >
                    <thead>
                        <tr>
                            <th>Pluginname</th>
                            <th>Description</th>
                            <th>Version</th>
                        </tr>
                    </thead>
                    <tbody>
                        {props.plugins}
                    </tbody>
                </table>
            </div>
        )
    }
    else{
        return (
            <p>No plugins are installed. Visit our <a href="https://hackmd.io/rcdkXnEISPiPAnwo8INbGw#Integration-guide">documentation</a> to learn about Malwarecgae plugins and how they can be used and installed.</p>
        )
    }
}

class About extends Component {
    render() {
        let plugins = Object.entries(this.props.config["active_plugins"]).sort().map(([key, value]) => (
            <PluginItems
                name={key}
                info = {value}
            />
        ));

        return (
            <div className="align-items-center">
                <div className="jumbotron d-flex align-items-center" style={{backgroundColor: "#101c28", color: "white"}}>
                    <View ident="about">
                        <div className="row">
                            <div className="col-lg-3 col-sm-6 offset-1">
                                <img src={logo} alt="logo" width="100%"/>
                            </div>
                            <div className="col-lg-8 col-sm-6">
                                <h1>malwarecage</h1>
                                <p>
                                    Powered by CERT.pl<br/>
                                    Version: {this.props.config["server_version"]}<br/>
                                    Try out our <a href="https://pypi.org/project/mwdblib/" style={{color: "lime"}}>mwdblib library</a>!
                                </p>
                            </div>
                        </div>
                    </View>
                </div>
                <PluginsTable plugins={plugins} />
            </div>
        );
    }
}

function mapStateToProps(state, ownProps)
{
    return {
        ...ownProps,
        config: state.config.config
    }
}

export default connect(mapStateToProps)(About);
