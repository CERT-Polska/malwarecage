export let encodeSearchQuery = function(query) {
    // We need to escape this twice because of this bug: https://github.com/ReactTraining/history/issues/505
    return encodeURIComponent(encodeURIComponent(query))
}

export let decodeSearchQuery = function(query) {
    let pathname = decodeURIComponent(query);
    try {
        return decodeURIComponent(pathname);
    } catch (_error) {
        return pathname;
    }
}

export let escapeSearchValue = function(input) {
    if (typeof input === "string") {
        input = JSON.stringify(input)
    } else
    {
        input = String(input)
    }
    return input
}

export let makeSearchLink = function(field, input, noEscape, endpoint){
    if (input === undefined)
        return "";

    let prefix = field + ":";

    if(!noEscape)
        input = escapeSearchValue(input);
    return `/${endpoint === undefined ? "search" : endpoint}?q=`+encodeSearchQuery(prefix + input);
};

export let makeSearchConfigElementLink = function(element, value) {
    if(value !== undefined)
        return makeSearchLink("cfg", `*"${element}": ${escapeSearchValue(value)}*`, false, "configs")
    return makeSearchLink("cfg", `*${escapeSearchValue(element)}*`, false, "configs")
}

export let makeSearchRangeLink = function(field, from, to, endpoint){
    return makeSearchLink(field, `[${escapeSearchValue(from)} TO ${escapeSearchValue(to)}]`, true, endpoint)
}

export let makeSearchDateLink = function(field, date, endpoint) {
    return makeSearchLink(
        field,
        new Date(date).toISOString().split("T")[0],
        true,
        endpoint)
}